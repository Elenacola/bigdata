{"paragraphs":[{"text":"%md # Sentiment Analysis con le Recensioni di Yelp\n","user":"anonymous","dateUpdated":"2019-08-11T13:51:16+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1565517585373_1232862239","id":"20190809-164912_906063518","dateCreated":"2019-08-11T09:59:45+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:6491","dateFinished":"2019-08-11T13:51:16+0000","dateStarted":"2019-08-11T13:51:16+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Sentiment Analysis con le Recensioni di Yelp</h1>\n</div>"}]}},{"text":"%md\n## Carichiamo il Dataset in un DataFrame","user":"anonymous","dateUpdated":"2019-08-11T13:45:27+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"results":{},"enabled":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1565517585378_-290474566","id":"20190809-165119_872641820","dateCreated":"2019-08-11T09:59:45+0000","dateStarted":"2019-08-11T13:45:27+0000","dateFinished":"2019-08-11T13:45:30+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6492"},{"text":"%pyspark\nyelp_df = sqlContext.read.json('hdfs:///yelp/yelp_academic_dataset_review.json')\nyelp_df.show(5)","user":"anonymous","dateUpdated":"2019-08-11T10:47:39+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-14-42.us-west-2.compute.internal:4040/jobs/job?id=5","http://ip-172-31-14-42.us-west-2.compute.internal:4040/jobs/job?id=6"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1565517585378_-211275667","id":"20190809-143800_1692851053","dateCreated":"2019-08-11T09:59:45+0000","dateStarted":"2019-08-11T10:47:39+0000","dateFinished":"2019-08-11T10:47:57+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6493"},{"text":"%pyspark\ndata_df = yelp_df.select([\"text\", \"stars\"])","user":"anonymous","dateUpdated":"2019-08-11T10:48:00+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1565517585379_-933814343","id":"20190809-143958_955836200","dateCreated":"2019-08-11T09:59:45+0000","dateStarted":"2019-08-11T10:48:00+0000","dateFinished":"2019-08-11T10:48:00+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6494"},{"text":"%md\n## Preprocessiamo i dati","user":"anonymous","dateUpdated":"2019-08-11T13:51:20+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1565517585379_-132247265","id":"20190809-165137_373018509","dateCreated":"2019-08-11T09:59:45+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:6495","dateFinished":"2019-08-11T13:51:20+0000","dateStarted":"2019-08-11T13:51:20+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Preprocessiamo i dati</h2>\n</div>"}]}},{"text":"%pyspark\nfrom pyspark.sql.functions import udf\nimport string\n\ndef remove_punct(text):\n    return text.translate(str.maketrans('', '', string.punctuation))\n\npunct_remove = udf(lambda s: remove_punct(s))\ndata_df = data_df.withColumn(\"text\", punct_remove(data_df[\"text\"]))\n","user":"anonymous","dateUpdated":"2019-08-11T10:48:04+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1565517585380_770408910","id":"20190809-144046_1007786737","dateCreated":"2019-08-11T09:59:45+0000","dateStarted":"2019-08-11T10:48:04+0000","dateFinished":"2019-08-11T10:48:04+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6496"},{"text":"%pyspark\nfrom pyspark.ml.feature import Tokenizer\n\ntokenizer = Tokenizer(inputCol=\"text\", outputCol=\"words\")\ndata_df = tokenizer.transform(data_df)","user":"anonymous","dateUpdated":"2019-08-11T10:48:07+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1565517585380_806631901","id":"20190809-144504_589797808","dateCreated":"2019-08-11T09:59:45+0000","dateStarted":"2019-08-11T10:48:07+0000","dateFinished":"2019-08-11T10:48:07+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6497"},{"text":"%pyspark\nfrom pyspark.ml.feature import StopWordsRemover\n\nstopwords = StopWordsRemover(inputCol=\"words\", outputCol=\"filtered\")\ndata_df = stopwords.transform(data_df)\n","user":"anonymous","dateUpdated":"2019-08-11T10:48:10+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1565517585380_-584110631","id":"20190809-144518_1515925512","dateCreated":"2019-08-11T09:59:45+0000","dateStarted":"2019-08-11T10:48:10+0000","dateFinished":"2019-08-11T10:48:10+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6498"},{"text":"%pyspark\nfrom pyspark.ml.feature import HashingTF, IDF\n\nhashing_tf = HashingTF(inputCol='words', outputCol='raw_features')\ndata_df = hashing_tf.transform(data_df)\n\nidf = IDF(inputCol=\"raw_features\", outputCol=\"features\")\nidf_model = idf.fit(data_df)\ndata_df = idf_model.transform(data_df)","user":"anonymous","dateUpdated":"2019-08-11T10:48:13+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-14-42.us-west-2.compute.internal:4040/jobs/job?id=7"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1565517585381_-1726911519","id":"20190809-144532_992374579","dateCreated":"2019-08-11T09:59:45+0000","dateStarted":"2019-08-11T10:48:13+0000","dateFinished":"2019-08-11T10:52:24+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6499"},{"text":"%pyspark\nfrom pyspark.sql.functions import when\n\ndata_df = data_df.filter(\"stars != 3.0\")\ndata_df = data_df.withColumn(\"label\", when(data_df[\"stars\"]>=3.5, 1).otherwise(0))","user":"anonymous","dateUpdated":"2019-08-11T10:49:23+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1565517585381_1795502240","id":"20190809-144622_1883967749","dateCreated":"2019-08-11T09:59:45+0000","dateStarted":"2019-08-11T10:49:23+0000","dateFinished":"2019-08-11T10:52:24+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6500"},{"text":"%pyspark\ntrain_df, test_df = data_df.randomSplit([0.9, 0.1])","user":"anonymous","dateUpdated":"2019-08-11T10:49:33+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1565517585381_-1538170358","id":"20190809-144627_136055176","dateCreated":"2019-08-11T09:59:45+0000","dateStarted":"2019-08-11T10:52:24+0000","dateFinished":"2019-08-11T10:52:24+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6501"},{"text":"%md\n## Creiamo il Modello","user":"anonymous","dateUpdated":"2019-08-11T13:51:10+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1565517585382_-529789037","id":"20190809-165208_657019199","dateCreated":"2019-08-11T09:59:45+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:6502","dateFinished":"2019-08-11T13:51:10+0000","dateStarted":"2019-08-11T13:51:10+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Creiamo il Modello</h2>\n</div>"}]}},{"text":"%pyspark\nn_samples = train_df.count()\nneg_samples = traind_df.filter(\"label==0\").count()\nneg_ratio = neg_samples/n_samples","user":"anonymous","dateUpdated":"2019-08-11T13:50:33+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1565531377166_-334217894","id":"20190811-134937_1383554315","dateCreated":"2019-08-11T13:49:37+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6503"},{"text":"%pyspark\nbalanced_df = train_df.withColumn(\"classWeight\", when(train_df[\"label\"]==0,1-neg_ratio).otherwise(neg_ratio))\nbalanced_df.show(20)","user":"anonymous","dateUpdated":"2019-08-11T13:49:42+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1565531192103_-1739733516","id":"20190811-134632_2053393001","dateCreated":"2019-08-11T13:46:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6504"},{"text":"%pyspark\nfrom pyspark.ml.classification import LogisticRegression\n\nlr = LogisticRegression(featuresCol=\"features\", labelCol=\"label\", weightCol=\"classWeight\", regParam=0.1)\nmodel = lr.fit(balanced_df)","user":"anonymous","dateUpdated":"2019-08-11T13:46:07+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1565517585382_1385121252","id":"20190809-144637_996371631","dateCreated":"2019-08-11T09:59:45+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6505"},{"text":"%pyspark\nevaluation = model.evaluate(test_df)\nprint(evaluation.accuracy)\nprint(evaluation.precisionByLabel)\nprint(evaluation.recallByLabel)","user":"anonymous","dateUpdated":"2019-08-11T11:43:11+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-14-42.us-west-2.compute.internal:4040/jobs/job?id=65","http://ip-172-31-14-42.us-west-2.compute.internal:4040/jobs/job?id=66","http://ip-172-31-14-42.us-west-2.compute.internal:4040/jobs/job?id=67"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1565521032063_-1261115215","id":"20190811-105712_1880548681","dateCreated":"2019-08-11T10:57:12+0000","dateStarted":"2019-08-11T11:43:11+0000","dateFinished":"2019-08-11T12:59:50+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6506"}],"name":"yelp_sentiment_analysis","id":"2EMCRGDKD","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}